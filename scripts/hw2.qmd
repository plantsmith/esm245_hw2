---
title: "Differences-in-Differences Causal Analysis of a Fishery Management Reform in Peru"
author: "Natalie Smith"
date: "10/10/2021"
format: 
  html:
    code-fold: true
    toc: true
    number-sections: true
    embed-resources: true
theme: Litera
editor: visual
execute:
  echo: true
  message: false
  warning: false
---

# Background:

In 2009, the Individual Vessel Quota (IVQ) system was implemented for Peruvian anchoveta fisheries in the North-Central zone to enhance stock monitoring, alleviate fishing pressure, and incentivize sustainable practices. This policy allocated each vessel a percentage of the Total Allowable Catch (TAC) based on its historical performance, while also varying seasonally based on biological, weather, and climate variables. Additionally, the system introduced several additional measures, including a seasonal tax on harvested tons, satellite surveillance for better compliance, and designated docks to weight the landing.

We aim to assess whether the IVQ had a causal effect on harvest levels, using the South zone, which was not subject to policy, as a counterfactual. Through a differences-in-differences (DiD) analysis, we will compare the North-Central zone (affected by the IVQ) and the South zone (unaffected) before and after the policy's implementation. This approach will help us determine whether the IVQ resulted in changes in fishery landings while accounting for external factors influencing both zones.

![Figure 1: Arias Schreiber and Halliday, 2013](images/anchovy_map.png){fig-align="left" width="384"}

# Prepare Libraries & Data: 

```{r}
library(tidyverse)
library(knitr)
library(here)
library(kableExtra)
```

```{r}
# Load the data using here package
anchovy_data <- read_csv(here("data", "df_peru.csv"))
```

# Employ Diff-in-Diff Analysis:

We first created a new variable called 'log_landing' by taking the logarithm of the 'landing' variable. Then, we created two dummy variables: one named 'post' to indicate when the treatment began (1 for 2009 and after, 0 for before), and another variable called 'north' to identify the group exposed to the treatment (1 for NC and 0 for S). Next, we created an interaction between these variables called 'did' (differences-in-differences). This interaction variable is equal to 1 only for observations that are both in the treatment group and occur after the treatment started. Finally, we performed a linear regression based on the functional form below:

$$
Landing_{tg} = \alpha + \beta_0 North_{g} + \beta_1Post_{t} + \beta_3North_{g}Post_{t} + \epsilon_{tg}
$$

```{r}
#Create a new variable called log_landing by taking the log of the landings variable
log_anchovy_data <- anchovy_data %>%
  mutate(log_landing = log(landing))

#Create a dummy variable called 'post' to indicate when the treatment started (year 2009)
log_anchovy_data <- log_anchovy_data %>%
  mutate(post = ifelse(year >= 2009, 1, 0))

#Create a dummy variable called 'north' to identify the group (zone) exposed to the treatment (CN)
log_anchovy_data <- log_anchovy_data %>% 
  mutate(north = ifelse(zone=="CN", 1, 0))

#Create the interaction between the time the treatment started and the treatment group
log_anchovy_data <- log_anchovy_data %>% 
  mutate(did = post*north)

#Run a linear regression using the functional form proposed above
lm_anchovy <- lm(log_landing ~ north + post + did, data = log_anchovy_data)
```

```{r}
kable(summary(lm_anchovy)$coefficients, digits = 3, 
      col.names = c("Estimate", "Std. Error", "T-value", "Pr(>|t|)"), # Rename columns
      caption = "Linear Model Coefficients for Anchovy Landings")
```

# Interpretation of the DiD Coefficients:

```{r}
#calculate percentage change in NC landings
percentage_change <- exp(coef(lm_anchovy)[4]) - 1
```

The coefficient estimates from the linear regression model indicate the following:

-   The intercept of 4.603 represents the log-transformed value of anchovy landings in the South zone before the policy was implemented.
-   The coefficient for 'north' of 0.311 indicates that landings in the North Central zone were 31.1% higher than the South zone before the policy was implemented.
-   After the policy, landings increase by 17.1% in both zones, as shown by the 'post' coefficient of 0.171.
-   However, the differences-in-differences (DiD) estimate of -0.176 suggests a 17.6% decrease in landings in the NC zone relative to the South zone after the policy.
-   High T values for all coefficients indicate that the estimates are statistically significant.
-   While both zones experienced increases in landings, the IVQ policy had a negative impact in the NC zone, reducing landings by 16.2% compared to what might have been expected in the South zone.

# Analysis

### *Question 1:* 

*We used the South as a counterfactual region because the policy wasnâ€™t applied there. Describe one or more possible problems with this assumption.*

There could be other variables at play - for example what if there was a storm in the North that caused a decrease in landings.

What is the landings were decreasing naturally?

### *Question 2:* 

*To analyze whether the counterfactual makes sense, take the mean of log_landing before and after the policy for each zone. Show your results in a table.*

```{r}
#take the mean of log_landing before and after the policy for each zone
mean_anchovy_data <- log_anchovy_data %>%
  group_by(zone, post) %>%
  summarize(mean_log_landing = mean(log_landing))

#summarize in a kable table
kable(mean_anchovy_data, digits = 3, 
      col.names = c("Zone", "Post", "Mean Log Landing"), 
      caption = "Mean Log Landing Before and After the Policy for Each Zone")


```

### *Question 3:* 

*Does the parallel trends assumption seem to hold? What are the implications of this for your analysis*?
